---
layout: default
---
{% assign util = site.data.utility %}
{% assign projects = site.projects %}

{% for entry in site.data.calendar %}
  {% assign week_int = forloop.index | times: 1 %}
  {% capture week_num %}{% if week_int < 10 %}0{% endif %}{{ week_int }}{% endcapture %}
  {% assign week = site.weeks[forloop.index0] %}
  {% assign current = true %}
  {% assign today = "today" | date: "%s" %}
  {% assign expiry = entry.expires | date: "%s" %}


  <article id="week-{{ week_num }}" data-week="{{ entry.begins | date: '%U' }}" data-expires="{{ entry.expires }}">
    {% if today < expiry and current == true %}
      <header id="this-week">
      {% assign current = false %}
    {% else %}
      <header>
    {% endif %}
      <h3>
        {{ week.theme | escape }}
      </h3>
      <small>Week&nbsp;{{ util.spelled_nums[week_int] }}</small>
    </header>
    {% for meeting in week.meetings %}
    <section class="agenda">
      {% if site.course.days.size > 0 %}
        {% assign day_key = site.course.days[forloop.index0] | downcase %}
        {% assign day_offset = site.data.utility.day_offsets[day_key] | times: 1 %}
        {% capture dateline %}{{ entry.begins | date: "%s" | plus: day_offset | date: "%A, %B %e" }}{% endcapture %}
      {% else %}
        {% capture dateline %}Discussion Topics for the Week of {{ entry.begins | date: "%B %e" }}{% endcapture %}
      {% endif %}
      <h4>{{ dateline }}{% if meeting.video %} <a href="{{ meeting.video }}">Video</a>{% endif %}</h4>
      <ol>
        {% for item in meeting.agenda %}
          <li>{{ item | markdownify | remove: "<p>" | remove: "</p>" | strip_newlines }}</li>
        {% endfor %}
      </ol>
    </section>
    {% endfor %}
    {% if week.readings or week.tasks %}
    <aside class="assigned">
      <header>
        <h3>Assigned Work</h3>
      </header>
      {% if week.readings %}
      <section class="readings">
        <h4>To Read</h4>
        <ol>
          {% for reading in week.readings %}
            <li>{{ reading | markdownify | remove: "<p>" | remove: "</p>" | strip_newlines }}</li>
          {% endfor %}
        </ol>
      </section>
      {% endif %}
      {% if week.tasks %}
      <section class="tasks">
        <h4>To Do</h4>
        <ol>
          {% for task in week.tasks %}
            <li>{{ task | markdownify | remove: "<p>" | remove: "</p>" | strip_newlines }}</li>
          {% endfor %}
          {% for project in projects %}
            {% assign proj_int = forloop.index | times: 1 %}
            {% capture proj_num %}{% if proj_int < 10 %}0{% endif %}{{ proj_int }}{% endcapture %}
            {% assign be = entry.begins | date: "%s" %}
            {% assign ex = entry.expires | date: "%s" %}
            {% for deliverable in project.deliverables %}
              {% assign dl = deliverable.deadline | date: "%s" %}
              {% if dl > be and dl < ex %}
                <li class="deadline">Project {{ util.spelled_nums[proj_int] }}: {{ deliverable.action }} (Due by {{ deliverable.deadline | date: "%A, %B %e" }})</li>
              {% endif %}
            {% endfor %}
            {% for milestone in project.milestones %}
              {% assign dl = milestone.deadline | date: "%s" %}
              {% if dl > be and dl < ex %}
                <li class="milestone">Project {{ util.spelled_nums[proj_int] }}: {{ milestone.action }} (Milestone due by {{ milestone.deadline | date: "%A, %B %e" }})</li>
              {% endif %}
            {% endfor %}
          {% endfor %}
        </ol>
      </section>
      {% endif %}
    </aside>
    {% endif %}
  </article>
{% endfor %}
